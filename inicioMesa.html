<!DOCTYPE html>
<!--<![endif]-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="google-site-verification" content="X-NyWbTQ-1CgZ7cvLZYPOc0BzO7PblJv201J3PJXAJI">


  <title>Drink N Play</title>

  <meta name="description" content="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.">
  <meta name="viewport" content="width=device-width, target-densityDpi=device-dpi, initial-scale=1.0, maximum-scale=1.5">


  <script type="text/javascript" src="./assets/main.js"></script>
  <script type="text/javascript" src="./assets/pd.js"></script>
  <script type="text/javascript" async="" src="./assets/inpage_linkid.js" id="undefined"></script>
  <script type="text/javascript" async="" src="./assets/bf.min.js"></script>
  <script type="text/javascript" async="" src="./assets/ga.js"></script>
  <script src="./assets/30715011.js"></script>

  <link rel="icon" type="image/png" href="//www.pubnub.com/static/images/structure/drinkNplay.png">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Press+Start+2P">
  <link rel="stylesheet" href="//www.pubnub.com/static/css/styles.css?ts=1404164785">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="./css/pong.css">
  <!--[if lt IE 9]> <script src="/static/js/ie.js?ts=1404164785"></script> <![endif]-->

  <link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">

</head>

<body id="app" class="satemplate" data-ember-extension="1">
<!-- Google Tag Manager -->


  <div id="alert_container" class="alert  hidden"></div>
  <style media="screen">
    a[name=tutorial]:before {
      content: "";
      display: block;
      height: 100px;
      /* fixed header height*/
      margin: -100px 0 0;
      /* negative fixed header height */
    }
    #app-hero {
      background:whitesmoke;
      background-attachment: fixed;
    }
    #demo {
      background: white;
      background-attachment: fixed;
    }
    .code {
      font-family: "Courier New", Courier, monospace;
      font-size: 15px;
    }
    #game {
      display: block;
      /*margin: 0 auto;*/
    }
    #qrcode {
      display: block;
      margin: 20px auto;
      text-align: center;
    }

    #areana {
      top: 0px;
      position: relative;
      left: 126px;
    }
  </style>
  <!-- <div id="qrcode"></div> -->
  <div class="section gray padding-extra" id="app-hero">
    <div class="container">
      <h1 class="text-center" style="font-family: 'Press Start 2P', cursive;">Drink N Play</h1>
      <div class="row">
        <div class="col-sm-6 col-sm-offset-3" style="margin-bottom: -40px;">
          <p class="text-center">
          Read the QR code below to play from your mobile device or open up another window to access the controls from your browser.
          <h4 class="text-center"><a href="" id="controlLink">Controls</a></h4>
          </p>
          <div id="qrcode"></div>
        </div>
      </div>
    </div>
  </div>


  <div class="section padding-extra white" id="demo" style="margin-top: -100px; min-height: 0px;">
     <div class="row">
       <div class="col-xs-2">&nbsp;</div>
          <div id="areana" class="col-xs-8">

            <div id="row">
              <div id="col-xs-14">
                <canvas id="game"></canvas>

                <div class="modal fade bs-example-modal-sm" id="playAgain">
                  <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Play Again?</h4>
                      </div>
                      <div class="modal-body">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Nah I'm good</button>
                        <button type="button" class="btn btn-primary" id="REMATCH">REMATCH NOW</button>
                      </div>
                    </div><!-- /.modal-content -->
                  </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->

                <script src="bower_components/underscore/underscore-min.js"></script>
                <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

                <script src="js/game.js" type="text/javascript"></script>
                <script src="js/pong.js" type="text/javascript"></script>
                <script src="js/pubgame.js" type="text/javascript"></script>
                <script src="js/utils.js" type+"text/javascript"></script>
                <script type="text/javascript">

                $("#REMATCH").click(function() {window.location.reload()});

                  window.oldSchoolCool = true;
                  Game.ready(function() {
                        var pong = Game.start('game', Pong, {sound: false});
                  });

                  $("#game").show();
                  $(document).ready( function() {
                    setTimeout(function() {
                      window.PongGame.start(1);
                    }, 0);
                  });
                  </script>
                  <script src="./js/prefixfree.min.js" type="text/javascript"></script>
                </div>
              </div>


            <iframe id="game" src="img/blank.png" width="640" height="480" scrolling="no" seamless="seamless" frameborder="0">
                <p>Your browser does not support iframes.</p>
              </iframe>
            </div>
      <div class="col-xs-2">&nbsp;</div>
    </div>
  </div>

  <a name="tutorial"></a>


  <script src="./dist/jquery.min.js"></script>
  <script src="./pubnub/dist/web/pubnub.min.js"></script>
  <script src="./assets/main.js"></script>
  <script src="./qrcode-generator/js/qrcode.js"></script>


  <script>

    var makeQRCode = function(props){
       var gameQRCode = qrcode(4,'L');
       var targ = props.text.replace(/^[\s\u3000]+|[\s\u3000]+$/g, '');
       var t = targ.replace(/^[\s\u3000]+|[\s\u3000]+$/g, '');
       gameQRCode.addData(t);
       gameQRCode.make();
       return gameQRCode.createSvgTag();
    }


    var rand = Math.floor(Math.random()*10000);

    var pubnub = new PubNub({
      publishKey: 'pub-c-0ecaf3c4-bc3a-4e03-94e7-e85e196fdc4c',
      subscribeKey: 'sub-c-673a62aa-24c9-11e4-a77a-02ee2ddab7fe'
    });


    var presenceCallback = function(status, response){
         if ((response.channels["pongnub" + rand]) && (response.channels["pongnub" + rand].occupancy > 0)){
           if ($("#game").attr('src') !== ("game.html?id=" + rand)){
            $("#game").attr("src", "game.html?id=" + rand);
           }
         }
      };


    var chan = "pongnub" + rand;
    var z = setInterval(function() {
        pubnub.hereNow({
          channels: [chan]
          ,includeState: false
          ,includeUUIDS: false},
          presenceCallback);
    }, 1000);


  $("#controlLink").attr("href", "controller.html?id=" + rand);

   var controllerURL = window.location.protocol + "//"
                       + window.location.hostname
                       + "./controller.html?id=" + rand

  var props = { text: controllerURL,
                width: 164,
                height: 164,
                colorDark: "#444",
                colorLight: "#ffffff"
              };

  var qrCode = document.getElementById('qrcode');
  qrCode.innerHTML = makeQRCode(props);

  </script>

  <div id="loading">
    <div class="mask"></div>
    <div class="indication">
      <img src="./assets/loading.gif">
      <h3 class="text-red">Loading...</h3>
    </div>
  </div>





</body>

</html>
